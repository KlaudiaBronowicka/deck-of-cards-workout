<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:d="http://xamarin.com/schemas/2014/forms/design"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:rf="clr-namespace:RedCorners.Forms;assembly=RedCorners.Forms"
             mc:Ignorable="d"
             x:Class="DeckOfCards.Views.WorkoutPage"
             xmlns:converters="clr-namespace:DeckOfCards.Converters"
             xmlns:utility="clr-namespace:DeckOfCards.Utility;assembly=DeckOfCards"
             utility:ViewModelLocator.AutoWireViewModel="True"
             xmlns:skiaforms="clr-namespace:SkiaSharp.Views.Forms;assembly=SkiaSharp.Views.Forms"
             xmlns:flex="clr-namespace:Flex.Controls;assembly=Flex">
    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:SecondsToTimeConverter x:Key="timeConvert" />
            <converters:CardNumberConverter x:Key="cardNumberConvert" />
            <converters:CardSymbolToImageConverter x:Key="cardSymbolImageConvert" />
            <converters:BoolToValueConverter x:Key="gamePausedTextConvert" x:TypeArguments="x:String" TrueValue="RESUME" FalseValue="PAUSE"  />
            <converters:InverseBoolConverter x:Key="inverseBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>
    <ContentPage.Content>
        <Grid
            VerticalOptions="FillAndExpand"
            HorizontalOptions="FillAndExpand">
             <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" /> <!-- Top bar -->
                    <RowDefinition Height="Auto" /> <!-- Card view -->
                    <RowDefinition Height="Auto" /> <!-- Buttons -->
                    <RowDefinition Height="*" /> <!-- Rest of the screen -->
                </Grid.RowDefinitions>

            <!-- Gradient background -->
             <skiaforms:SKCanvasView
                 Grid.Row="0"
                 Grid.Column="0"
                 Grid.RowSpan="4"
                 x:Name="canvasView"
                 PaintSurface="OnCanvasViewPaintSurface" />

            <!-- Top bar -->
            <Grid Grid.Row="0" >
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <Label
                    Grid.Column="0"
                    HorizontalTextAlignment="Start"
                    Text="{Binding CurrentCardIndex, Converter={StaticResource cardNumberConvert}}"
                    Margin="20, 20, 0, 0"
                    Style="{StaticResource TopBarLabelStyle}">
                </Label>
                <Label
                    Grid.Column="1"
                    HorizontalTextAlignment="End"
                    Text="{Binding Seconds, Converter={StaticResource timeConvert}}"
                    Margin="0, 20, 20, 0"
                    Style="{StaticResource TopBarLabelStyle}">
                </Label>
            </Grid>

            <!-- Card view -->
            <rf:Frame2
                x:Name="CardView"
                Grid.Row="1"
                HasShadow="True"
                ShadowRadius="24"
                ShadowColor="Black"
                BackgroundColor="{StaticResource Light}"
                CornerRadius="16"
                Margin="40"
                Padding="0">

                <rf:Frame2.GestureRecognizers>
                    <TapGestureRecognizer Tapped="CardTappedEvent"/>
                    <SwipeGestureRecognizer Direction="Left" Swiped="CardSwipedEvent"/>
                </rf:Frame2.GestureRecognizers>

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="70"/>
                        <RowDefinition Height="300"/>
                        <RowDefinition Height="70"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="70" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="70" />
                    </Grid.ColumnDefinitions>

                    <Frame
                        x:Name="cardCoverImage"
                        Grid.Row="0"
                        Grid.Column="0"
                        Grid.RowSpan="3"
                        Grid.ColumnSpan="3"
                        BackgroundColor="{StaticResource Light}"
                        CornerRadius="12"
                        Margin="10"
                        Padding="0"
                        HasShadow="False"
                        IsVisible="{Binding IsGameRunning, Converter={StaticResource inverseBoolConverter}}">
                         <Image
                            Aspect="AspectFill"
                            Source="card.png"/>
                    </Frame>

                    <Image
                        x:Name="TopLeftCardSymbol"
                        WidthRequest="50"
                        HeightRequest="50"
                        Grid.Row="0"
                        Grid.Column="0"
                        Source="{Binding CurrentCard.Symbol, Converter={StaticResource cardSymbolImageConvert}}"
                        Margin="20, 20, 0, 0">
                    </Image>
                    <Image
                        x:Name="TopRightCardSymbol"
                        WidthRequest="50"
                        HeightRequest="50"
                        Grid.Row="0"
                        Grid.Column="2"
                        Margin="0, 20, 20, 0"
                        Source="{Binding CurrentCard.Symbol, Converter={StaticResource cardSymbolImageConvert}}">
                    </Image>
                    <Image
                        x:Name="BottomLeftCardSymbol"
                        WidthRequest="50"
                        HeightRequest="50"
                        Grid.Row="2"
                        Grid.Column="0"
                        Margin="20, 0, 0, 20"
                        Source="{Binding CurrentCard.Symbol, Converter={StaticResource cardSymbolImageConvert}}">
                    </Image>
                    <Image
                        x:Name="BottomRightCardSymbol"
                        WidthRequest="50"
                        HeightRequest="50"
                        Grid.Row="2"
                        Grid.Column="2"
                        Margin="0, 0, 20, 20"
                        Source="{Binding CurrentCard.Symbol, Converter={StaticResource cardSymbolImageConvert}}">
                    </Image>

                    <Label
                        x:Name="ExerciseLabel"
                        Text="{Binding CurrentCard.Exercise}"
                        Style="{StaticResource CardLabelStyle}">
                    </Label>
                    <Label
                        x:Name="GameResumeLabel"
                        Text="Press to resume"
                        Style="{StaticResource CardLabelStyle}"
                        Opacity="0">
                    </Label>

                </Grid>
            </rf:Frame2>

            <Label
                x:Name="StartGameLabel"
                Grid.Row="2"
                Text="Tap the card to start"
                HorizontalOptions="FillAndExpand"
                HorizontalTextAlignment="Center"
                TextColor="{StaticResource Light}"
                FontSize="Large"
                Opacity="0.5"/>

            <!-- Buttons -->
            <Grid
                Grid.Row="2"
                x:Name="Buttons"
                HorizontalOptions="FillAndExpand"
                HeightRequest="200"
                BackgroundColor="Transparent"
                IsEnabled="False"
                Opacity="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="140"></RowDefinition>
                </Grid.RowDefinitions>

                <flex:FlexButton
                    Grid.Row="0"
                    x:Name="FinishButton"
                    Text="FINISH WORKOUT"
                    HorizontalOptions="FillAndExpand"
                    VerticalOptions="Start"
                    HeightRequest="50"
                    Margin="40, 10, 40, 10"
                    ClickedCommand="{Binding FinishButtonPressedCommand}"
                    CornerRadius="18"
                    ForegroundColor="{StaticResource Light}"
                    BackgroundColor="{StaticResource Secondary}"
                    HighlightBackgroundColor="#4f6784"
                    BorderThickness="0,0,0,4"
                    BorderColor="{StaticResource Primary}"
                    HighlightBorderColor="#2d3b4c"
                    FontSize="14"/>

                <flex:FlexButton
                    Grid.Row="0"
                    x:Name="PauseButton"
                    Text="{Binding IsGamePaused, Converter={StaticResource gamePausedTextConvert}}"
                    HorizontalOptions="FillAndExpand"
                    VerticalOptions="Start"
                    HeightRequest="50"
                    Margin="40, 10, 40, 10"
                    ClickedCommand="{Binding PauseButtonPressedCommand}"
                    CornerRadius="18"
                    ForegroundColor="{StaticResource Light}"
                    BackgroundColor="{StaticResource Secondary}"
                    HighlightBackgroundColor="#4f6784"
                    BorderThickness="0,0,0,4"
                    BorderColor="{StaticResource Primary}"
                    HighlightBorderColor="#2d3b4c"
                    FontSize="14"/>

            </Grid>
        </Grid>
    </ContentPage.Content>
</ContentPage>